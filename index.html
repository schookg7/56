<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ü—Ä–æ—Å—Ç–∏–π 3D Minecraft-–ø–æ–¥—ñ–±–Ω–∏–π —Å–≤—ñ—Ç</title>
<style>
  body { margin: 0; overflow: hidden; user-select: none; }
  #info {
    position: absolute;
    top: 10px; left: 10px;
    color: white;
    font-family: Arial, sans-serif;
    z-index: 1;
    background: rgba(0,0,0,0.4);
    padding: 8px 12px;
    border-radius: 6px;
  }
  #blockSelector {
    position: absolute;
    bottom: 10px; left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
    background: rgba(0,0,0,0.4);
    padding: 6px 12px;
    border-radius: 8px;
    z-index: 1;
  }
  .block-btn {
    width: 40px; height: 40px;
    font-size: 28px;
    cursor: pointer;
    user-select: none;
    background: #ccc;
    border-radius: 6px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .block-btn.selected {
    border: 3px solid orange;
  }
</style>
</head>
<body>

<div id="info">
  –õ–ö–ú ‚Äî –¥–æ–¥–∞—Ç–∏ –±–ª–æ–∫<br/>
  –ü–ö–ú ‚Äî –≤–∏–¥–∞–ª–∏—Ç–∏ –±–ª–æ–∫<br/>
  WASD + –º–∏—à–∞ ‚Äî —Ä—É—Ö<br/>
  –í–∏–±–µ—Ä—ñ—Ç—å –±–ª–æ–∫:
</div>

<div id="blockSelector">
  <div class="block-btn selected" data-block="grass" title="–¢—Ä–∞–≤–∞">üåø</div>
  <div class="block-btn" data-block="dirt" title="–ì—Ä—É–Ω—Ç">üü´</div>
  <div class="block-btn" data-block="stone" title="–ö–∞–º—ñ–Ω—å">‚¨õ</div>
  <div class="block-btn" data-block="water" title="–í–æ–¥–∞">üíß</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/PointerLockControls.js"></script>

<script>
  // –°—Ü–µ–Ω–∞, –∫–∞–º–µ—Ä–∞, —Ä–µ–Ω–¥–µ—Ä–µ—Ä
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x87ceeb); // –Ω–µ–±–æ
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

  const renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä—É—Ö—É –≤—ñ–¥ –ø–µ—Ä—à–æ—ó –æ—Å–æ–±–∏
  const controls = new THREE.PointerLockControls(camera, document.body);

  document.body.addEventListener('click', () => {
    controls.lock();
  });

  // –°–≤—ñ—Ç–ª–æ
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(5,10,7);
  scene.add(light);
  scene.add(new THREE.AmbientLight(0x404040));

  // –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –±–ª–æ–∫—ñ–≤
  const materials = {
    grass: new THREE.MeshLambertMaterial({color: 0x4caf50}),
    dirt: new THREE.MeshLambertMaterial({color: 0x8b5a2b}),
    stone: new THREE.MeshLambertMaterial({color: 0x555555}),
    water: new THREE.MeshLambertMaterial({color: 0x2196f3, transparent: true, opacity: 0.6}),
  };

  // –ö–∞—Ä—Ç–∞ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –±–ª–æ–∫—ñ–≤ - –∫–ª—é—á "x_y_z" => mesh
  const blocks = {};

  // –†–æ–∑–º—ñ—Ä –±–ª–æ–∫—É
  const BLOCK_SIZE = 1;

  // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–ª–æ–∫—É
  function createBlock(x, y, z, type){
    const geometry = new THREE.BoxGeometry(BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
    const material = materials[type] || materials['dirt'];
    const cube = new THREE.Mesh(geometry, material);
    cube.position.set(x, y, z);
    scene.add(cube);
    blocks[`${x}_${y}_${z}`] = cube;
  }

  // –ü–æ—á–∞—Ç–∫–æ–≤–∏–π –ø—Ä–æ—Å—Ç–∏–π “ë—Ä—É–Ω—Ç 10x1x10 –±–ª–æ–∫—ñ–≤
  for(let x=-5; x<5; x++){
    for(let z=-5; z<5; z++){
      createBlock(x, 0, z, 'grass');
    }
  }

  // –ü–æ—Ç–æ—á–Ω–∏–π –æ–±—Ä–∞–Ω–∏–π —Ç–∏–ø –±–ª–æ–∫—É
  let currentBlockType = 'grass';

  // –í–∏–±—ñ—Ä –±–ª–æ–∫—É UI
  const blockButtons = document.querySelectorAll('.block-btn');
  blockButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      blockButtons.forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      currentBlockType = btn.getAttribute('data-block');
    });
  });

  // –î–ª—è "–ø—Ä–æ–º—ñ–Ω—å" - —â–æ–± –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏, –∫—É–¥–∏ –∫–ª–∏–∫–Ω—É–ª–∏
  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();

  // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∫–∞–º–µ—Ä—É —Å–ø–æ—á–∞—Ç–∫—É –Ω–∞ 2 –º–µ—Ç—Ä–∏ –Ω–∞–¥ –∑–µ–º–ª–µ—é
  camera.position.set(0, 2, 5);

  // –ö–ª–∞–≤—ñ–∞—Ç—É—Ä–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è (WASD)
  const move = { forward: false, backward: false, left: false, right: false };
  const velocity = new THREE.Vector3();
  const direction = new THREE.Vector3();
  let prevTime = performance.now();

  document.addEventListener('keydown', (event) => {
    switch(event.code){
      case 'KeyW': move.forward = true; break;
      case 'KeyS': move.backward = true; break;
      case 'KeyA': move.left = true; break;
      case 'KeyD': move.right = true; break;
    }
  });

  document.addEventListener('keyup', (event) => {
    switch(event.code){
      case 'KeyW': move.forward = false; break;
      case 'KeyS': move.backward = false; break;
      case 'KeyA': move.left = false; break;
      case 'KeyD': move.right = false; break;
    }
  });

  // –§—É–Ω–∫—Ü—ñ—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∞–±–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –±–ª–æ–∫—É –ø–æ –∫–ª—ñ–∫—É
  function onClick(event){
    if(!controls.isLocked) return;

    // –û–±—á–∏—Å–ª—é—î–º–æ –ø–æ–∑–∏—Ü—ñ—é –º–∏—à—ñ –¥–ª—è raycaster
    mouse.x = 0;
    mouse.y = 0;

    raycaster.setFromCamera(mouse, camera);
    const intersects = raycaster.intersectObjects(Object.values(blocks));

    if(intersects.length > 0){
      const intersect = intersects[0];

      if(event.button === 0){ // –õ—ñ–≤–∞ –∫–Ω–æ–ø–∫–∞ - –¥–æ–¥–∞—Ç–∏ –±–ª–æ–∫ –ø–æ —Å—É—Å—ñ–¥—Å—Ç–≤—É
        const normal = intersect.face.normal;
        const pos = intersect.object.position.clone().add(normal);
        const key = `${pos.x}_${pos.y}_${pos.z}`;
        if(!blocks[key]){
          createBlock(pos.x, pos.y, pos.z, currentBlockType);
        }
      } else if(event.button === 2){ // –ü—Ä–∞–≤–∞ –∫–Ω–æ–ø–∫–∞ - –≤–∏–¥–∞–ª–∏—Ç–∏ –±–ª–æ–∫
        const obj = intersect.object;
        scene.remove(obj);
        const key = `${obj.position.x}_${obj.position.y}_${obj.position.z}`;
        delete blocks[key];
      }
    }
  }

  // –ó–∞–±–æ—Ä–æ–Ω—è—î–º–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–µ –º–µ–Ω—é –ü–ö–ú
  window.addEventListener('contextmenu', e => e.preventDefault());

  window.addEventListener('mousedown', onClick);

  // –ê–Ω—ñ–º–∞—Ü—ñ—è —Ç–∞ —Ä—É—Ö
  function animate(){
    requestAnimationFrame(animate);

    if(controls.isLocked){
      const time = performance.now();
      const delta = (time - prevTime) / 1000;

      velocity.x -= velocity.x * 10.0 * delta;
      velocity.z -= velocity.z * 10.0 * delta;

      direction.z = Number(move.forward) - Number(move.backward);
      direction.x = Number(move.right) - Number(move.left);
      direction.normalize();

      if(move.forward || move.backward) velocity.z -= direction.z * 400.0 * delta;
      if(move.left || move.right) velocity.x -= direction.x * 400.0 * delta;

      controls.moveRight(-velocity.x * delta);
      controls.moveForward(-velocity.z * delta);

      prevTime = time;
    }

    renderer.render(scene, camera);
  }

  animate();

  // –ü—ñ–¥–ª–∞—à—Ç–æ–≤—É—î–º–æ —Ä–æ–∑–º—ñ—Ä –∫–∞–Ω–≤–∞—Å–∞ –ø—ñ–¥ –≤—ñ–∫–Ω–æ
  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>

</body>
</html>
